{% extends "base.html" %}

{% block title %}Unsorted Images{% endblock %}

{% block head_extra %}
<style>
  .unsorted-grid { display: flex; flex-wrap: wrap; gap:1rem; }
  .unsorted-item {
    border:1px solid #444; border-radius:4px;
    padding:.5rem; width:150px;
    background: #1e2226;
    color: #eee;
  }
  .unsorted-item img {
    width:100%; height:100px;
    object-fit:cover; border-radius:4px;
  }
  .unsorted-item .info { font-size:.75rem; margin: .25rem 0; }
</style>
{% endblock %}

{% block content %}
  <h2>Unsorted Images</h2>
  {% if unsorted %}
    <div class="unsorted-grid">
      {% for u in unsorted %}
        <div class="unsorted-item">
          <img src="{{ url_for('static', filename=u.path) }}" alt="">
          <div class="info">
            Msg #{{ u.msg.id }}<br>
            {{ u.msg.contact_name or u.msg.phone_number }}<br>
            {{ u.msg.timestamp.strftime('%Y-%m-%d %H:%M') }}
          </div>
          <form method="POST" action="{{ url_for('assign_property') }}">
            <input type="hidden" name="message_id" value="{{ u.msg.id }}">
            <select name="property_id" class="form-select form-select-sm mb-1">
              <option value="">– Select property –</option>
              {% for prop in properties %}
                <option value="{{ prop.id }}">{{ prop.name }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-primary w-100">Assign</button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No unassigned images found.</p>
  {% endif %}
{% endblock %}
